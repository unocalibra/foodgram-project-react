# Foodgram - продуктовый помощник

Link: https://foodgramm.myftp.biz
IP: 158.160.27.251

## Автор: 

Якупов (https://github.com/unocalibra) Артём

Дипломная работа по специальности Python-разработчик курса Яндекс.Практикум. Данная работа является заключительным этапом обучения. *
В данной работе разработан бэкенд проекта согласно спецификации API. В репозитории есть папки frontend, backend, infra, tests:
* В папке `frontend` — файлы, необходимые для сборки фронтенда приложения. 
  ###### Одностраничное приложение на фреймворке [React](https://ru.reactjs.org/), предоставлен [Яндекс.Практикумом](https://practicum.yandex.ru/). 
* В папке `infra` — конфигурационные файлы nginx и docker-compose.yml, необходимые для сборки всего проекта.
* В папке `backend` — файлы, необходимые для сборки бэкенд приложения.
* В папке `tests` — файлы, необходимые для тестирования бэкенд приложения.
 
## Описание
Проект "Foodgram" – это "продуктовый помощник". На данном сервисе авторизированные пользователи могут публиковать рецепты, подписываться на публикации пользователей, добавлять  рецепты в список «Избранное», а также в корзину, которую можно скачивать сводным списком продуктов. Для неавторизированных пользователей доступны просмотр рецептов и страниц авторов.

#

## Подготовка сервера
### Добавить в Secrets на Github следующие данные:
```bash
# В Settings - Secrets and variables создаем переменный с вашими данными
# Это необходимо для работы с CI/CD, DockerHub, GitHub

MODE #production
HOST #011.222.333.444
USER #admin
PASSWORD #password
SSH_KEY #Приватный ключ
DOCKER_USERNAME #Логин от докера
DOCKER_PASSWORD #Пароль от докера
TELEGRAM_TO #ваш телеграм id
TELEGRAM_TOKEN #токер бота
#для использование базы данных SQLite3 укажите: MODE=dev
```

Все действия мы будем выполнять в Docker, docker-compose как на локальной машине так и на сервере ВМ Yandex.Cloud.
Предварительно установим на ВМ в облаке необходимые компоненты для работы:

*1. Подключитесь к своему серверу*

```bash
ssh admin@011.222.333.444
# admin: имя пользователя, под которым будет выполнено подключение к серверу
# 011.222.333.444: IP-адрес сервера 
```

*2. Обновите существующий список пакетов:*
```bash
sudo apt update
```

*3. Обновите установленные в системе пакеты и установите обновления безопасности:*
```bash
sudo apt upgrade -y
```

*3. Установите на сервер Docker:*
```bash
sudo apt install docker.io
```

*4. Чтобы проверить успешность установки, запустите следующую команду:*
```bash
docker-compose --version
# Вывод будет выглядеть следующим образом:
#docker-compose version 1.26.0, build 8a1c60f6
```

*5. Скопируйте файлы docker-compose.yaml и nginx/default.conf из вашего проекта на сервер в home/<ваш_username>/docker-compose.yaml и home/<ваш_username>/nginx/default.conf соответственно.:*
```bash
#Эти файлы нужно скопировать из директории infra локальной машины
scp docker-compose.yml nginx.conf admin@011.222.333.444:/home/admin/
```
## Запуск

Выполнить команды:

*   git add .
*   git commit -m "Коммит"
*   git push

После этого будут запущены процессы workflow:

*   проверка кода на соответствие стандарту PEP8 (с помощью пакета flake8) 
*   сборка и доставка докер-образа для контейнера web на Docker Hub
*   автоматический деплой проекта на боевой сервер
*   отправка уведомления в Telegram о том, что процесс деплоя успешно завершился

После успешного завершения процессов workflow на боевом сервере должны будут выполнены следующие команды:

```
sudo docker-compose exec backend python manage.py migrate

```

```
sudo docker-compose exec backend python manage.py collectstatic 
```

Затем необходимо будет создать суперюзера и загрузить в базу данных информацию об ингредиентах:

```
sudo docker-compose exec backend python manage.py createsuperuser

```

```
sudo docker-compose exec backend python manage.py load_import 

```


## В API доступны следующие эндпоинты:

* ```/api/users/```  Get-запрос – получение списка пользователей. POST-запрос – регистрация нового пользователя. Доступно без токена.

* ```/api/users/{id}``` GET-запрос – персональная страница пользователя с указанным id (доступно без токена).

* ```/api/users/me/``` GET-запрос – страница текущего пользователя. PATCH-запрос – редактирование собственной страницы. Доступно авторизированным пользователям. 

* ```/api/users/set_password``` POST-запрос – изменение собственного пароля. Доступно авторизированным пользователям. 

* ```/api/auth/token/login/``` POST-запрос – получение токена. Используется для авторизации по емейлу и паролю, чтобы далее использовать токен при запросах.

* ```/api/auth/token/logout/``` POST-запрос – удаление токена. 

* ```/api/tags/``` GET-запрос — получение списка всех тегов. Доступно без токена.

* ```/api/tags/{id}``` GET-запрос — получение информации о теге о его id. Доступно без токена. 

* ```/api/ingredients/``` GET-запрос – получение списка всех ингредиентов. Подключён поиск по частичному вхождению в начале названия ингредиента. Доступно без токена. 

* ```/api/ingredients/{id}/``` GET-запрос — получение информации об ингредиенте по его id. Доступно без токена. 

* ```/api/recipes/``` GET-запрос – получение списка всех рецептов. Возможен поиск рецептов по тегам и по id автора (доступно без токена). POST-запрос – добавление нового рецепта (доступно для авторизированных пользователей).

* ```/api/recipes/?is_favorited=1``` GET-запрос – получение списка всех рецептов, добавленных в избранное. Доступно для авторизированных пользователей. 

* ```/api/recipes/is_in_shopping_cart=1``` GET-запрос – получение списка всех рецептов, добавленных в список покупок. Доступно для авторизированных пользователей. 

* ```/api/recipes/{id}/``` GET-запрос – получение информации о рецепте по его id (доступно без токена). PATCH-запрос – изменение собственного рецепта (доступно для автора рецепта). DELETE-запрос – удаление собственного рецепта (доступно для автора рецепта).

* ```/api/recipes/{id}/favorite/``` POST-запрос – добавление нового рецепта в избранное. DELETE-запрос – удаление рецепта из избранного. Доступно для авторизированных пользователей. 

* ```/api/recipes/{id}/shopping_cart/``` POST-запрос – добавление нового рецепта в список покупок. DELETE-запрос – удаление рецепта из списка покупок. Доступно для авторизированных пользователей. 

* ```/api/recipes/download_shopping_cart/``` GET-запрос – получение текстового файла со списком покупок. Доступно для авторизированных пользователей. 

* ```/api/users/{id}/subscribe/``` GET-запрос – подписка на пользователя с указанным id. POST-запрос – отписка от пользователя с указанным id. Доступно для авторизированных пользователей

* ```/api/users/subscriptions/``` GET-запрос – получение списка всех пользователей, на которых подписан текущий пользователь Доступно для авторизированных пользователей. 

